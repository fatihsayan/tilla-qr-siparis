<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
    <title>Tilla Pastanesi - QR Men√º</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #fff8f0;
            min-height: 100vh;
            padding: 15px;
            padding-bottom: 80px;
        }

        /* HEADER */
        header {
            text-align: center;
            margin-bottom: 15px;
            padding: 15px;
            background: linear-gradient(135deg, #d2691e, #b85e1a);
            color: white;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        header h1 {
            font-size: clamp(1.5rem, 5vw, 2rem);
            margin-bottom: 5px;
            font-weight: 600;
        }

        header h2 {
            font-size: clamp(1rem, 4vw, 1.2rem);
            font-weight: 400;
            background: rgba(255,255,255,0.2);
            display: inline-block;
            padding: 5px 20px;
            border-radius: 50px;
        }

        #masaNo {
            font-weight: bold;
            background: white;
            color: #d2691e;
            padding: 3px 10px;
            border-radius: 20px;
            margin-left: 5px;
        }

        /* GARSON √áAƒûIR BUTONU */
        .garson-buton {
            text-align: center;
            margin: 15px 0;
        }

        .garson-buton button {
            background: #4caf50;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 50px;
            font-size: clamp(1rem, 4vw, 1.2rem);
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            display: inline-flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s;
            width: 100%;
            max-width: 300px;
            justify-content: center;
        }

        .garson-buton button:active {
            transform: scale(0.95);
        }

        .garson-buton button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        /* KATEGORƒ∞ BA≈ûLIKLARI */
        .kategori-baslik {
            grid-column: 1/-1;
            margin: 20px 0 15px 0;
        }
        
        .kategori-baslik h3 {
            color: #d2691e;
            border-bottom: 3px solid #d2691e;
            padding-bottom: 8px;
            font-size: clamp(1.2rem, 4vw, 1.5rem);
            display: inline-block;
        }

        /* MEN√ú GRID */
        .menu {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 12px;
            margin-bottom: 30px;
        }

        /* MEN√ú √ñƒûESƒ∞ */
        .item {
            background: white;
            border-radius: 15px;
            padding: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            border: 1px solid #f0d9b5;
            transition: transform 0.2s;
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .item:active {
            transform: scale(0.98);
        }

        .urun-resim {
            width: 100%;
            aspect-ratio: 1/1;
            object-fit: cover;
            border-radius: 12px;
            margin-bottom: 8px;
            background: #f8e0c0;
            border: 2px solid #d2691e;
        }

        .emoji-kutu {
            width: 100%;
            aspect-ratio: 1/1;
            background: #f8e0c0;
            border-radius: 12px;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: clamp(2rem, 5vw, 2.5rem);
            border: 2px solid #d2691e;
        }

        .item h3 {
            font-size: clamp(0.9rem, 3vw, 1rem);
            margin-bottom: 4px;
            color: #333;
            font-weight: 600;
            min-height: 2.4em;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .item p {
            font-size: clamp(0.75rem, 2.5vw, 0.8rem);
            color: #666;
            margin-bottom: 8px;
            flex-grow: 1;
            line-height: 1.3;
            min-height: 2.6em;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .item .fiyat {
            font-size: clamp(1rem, 3.5vw, 1.2rem);
            font-weight: bold;
            color: #d2691e;
            margin-bottom: 8px;
            text-align: center;
        }

        .item button {
            background: #d2691e;
            color: white;
            border: none;
            padding: 8px 5px;
            border-radius: 8px;
            font-size: clamp(0.8rem, 3vw, 0.9rem);
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
            width: 100%;
            margin-top: auto;
        }

        .item button:hover {
            background: #b85e1a;
        }

        /* SEPET ALANI */
        .sepet-alani {
            background: white;
            border-radius: 20px 20px 0 0;
            padding: 15px;
            box-shadow: 0 -4px 20px rgba(0,0,0,0.1);
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            max-height: 70vh;
            overflow-y: auto;
            transform: translateY(calc(100% - 60px));
            transition: transform 0.3s ease;
            z-index: 1000;
            border-top: 3px solid #d2691e;
        }

        .sepet-alani.acik {
            transform: translateY(0);
        }

        .sepet-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            cursor: pointer;
        }

        .sepet-header h2 {
            font-size: clamp(1.1rem, 4vw, 1.3rem);
            margin: 0;
            color: #d2691e;
        }

        .sepet-toggle {
            background: #d2691e;
            color: white;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }

        #sepet {
            list-style: none;
            margin-bottom: 10px;
            max-height: 250px;
            overflow-y: auto;
        }

        #sepet li {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px;
            border-bottom: 1px solid #f0d9b5;
            font-size: clamp(0.8rem, 3vw, 0.9rem);
        }

        .sepet-urun-adet {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .sepet-urun-adet button {
            background: #f0d9b5;
            color: #d2691e;
            border: none;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            font-weight: bold;
            font-size: 1rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .sepet-urun-adet span {
            min-width: 20px;
            text-align: center;
        }

        .sepet-toplam {
            font-size: clamp(1rem, 4vw, 1.2rem);
            font-weight: bold;
            color: #d2691e;
            text-align: right;
            margin-bottom: 10px;
            padding-top: 8px;
            border-top: 2px solid #f0d9b5;
        }

        .siparis-btn {
            background: #d2691e;
            color: white;
            border: none;
            padding: 12px;
            border-radius: 10px;
            font-size: clamp(1rem, 4vw, 1.1rem);
            font-weight: bold;
            width: 100%;
            cursor: pointer;
            transition: background 0.2s;
        }

        .siparis-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        /* TOAST Bƒ∞LDƒ∞Rƒ∞M */
        .toast {
            position: fixed;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%);
            background: #333;
            color: white;
            padding: 10px 20px;
            border-radius: 50px;
            font-size: 0.9rem;
            z-index: 2000;
            display: none;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }

        .toast.goster {
            display: block;
            animation: slideUp 0.3s;
        }

        @keyframes slideUp {
            from { bottom: 50px; opacity: 0; }
            to { bottom: 80px; opacity: 1; }
        }

        @media (max-width: 350px) {
            .menu {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>

    <header>
        <h1>üç∞ Tilla Pastanesi</h1>
        <h2>Masa No: <span id="masaNo">Y√ºkleniyor...</span></h2>
    </header>

    <!-- GARSON √áAƒûIR BUTONU -->
    <div class="garson-buton">
        <button onclick="garsonCagir()" id="garsonBtn">
            <span style="font-size: 1.5rem;">üõéÔ∏è</span>
            Garson √áaƒüƒ±r
        </button>
    </div>

    <main>
        <section>
            <div class="menu" id="menu">
                <div style="text-align: center; padding: 50px; grid-column: 1/-1;">Men√º y√ºkleniyor...</div>
            </div>
        </section>
    </main>

    <!-- SEPET ALANI -->
    <div class="sepet-alani" id="sepetAlan">
        <div class="sepet-header" onclick="sepetToggle()">
            <h2>üõí Sepetim</h2>
            <div class="sepet-toggle" id="sepetToggle">‚ñ≤</div>
        </div>
        
        <ul id="sepet">
            <li style="text-align: center; color: #666; list-style: none;">Sepetiniz bo≈ü</li>
        </ul>
        
        <div class="sepet-toplam" id="sepetToplam">Toplam: 0 TL</div>
        
        <button onclick="siparisGonder()" class="siparis-btn" id="siparisBtn">
            Sipari≈üi G√∂nder
        </button>
    </div>

    <!-- Bƒ∞LDƒ∞Rƒ∞M -->
    <div class="toast" id="toast"></div>

    <script>
         // ========== MEN√ú VERƒ∞Sƒ∞ - KATEGORƒ∞Lƒ∞ ==========
        const menu = [
            // üç∞ TATLILAR
            { id: 1, isim: "≈ûekerpare Porsiyon", fiyat: 70, kategori: "tatli", aciklama: "≈ûerbetli tatlƒ±", resim: "images/sekerpare.jpg", emoji: "üç∞" },
            { id: 2, isim: "Gaziantep Baklavasƒ± Porsiyon", fiyat: 120, kategori: "tatli", aciklama: "Antep fƒ±stƒ±klƒ±", resim: "images/baklava.jpg", emoji: "üç∞" },
            { id: 3, isim: "Tulumba Tatlƒ±sƒ± Porsiyon", fiyat: 50, kategori: "tatli", aciklama: "Kƒ±zartma tatlƒ±", resim: "images/tulumba.jpg", emoji: "üç∞" },
            { id: 4, isim: "Ekler Pasta Porsiyon", fiyat: 80, kategori: "tatli", aciklama: "Kremalƒ±", resim: "images/ekler.jpg", emoji: "üç∞" },
            { id: 5, isim: "Baton Pasta Dilim", fiyat: 90, kategori: "tatli", aciklama: "√áikolata kaplƒ±", resim: "images/baton.jpg", emoji: "üç∞" },
            { id: 6, isim: "Dubai √áikolatasƒ±", fiyat: 400, kategori: "tatli", aciklama: "√ñzel Dubai √ßikolatasƒ±", resim: "images/dubai.jpg", emoji: "üç∞" },
            { id: 7, isim: "Kurabiye Porsiyon", fiyat:100, kategori: "tatli", aciklama: "Tereyaƒülƒ± kurabiye", resim: "images/kurabiye.jpg", emoji: "üç∞" },
            { id: 8, isim: "Kek Adet", fiyat: 50, kategori: "tatli", aciklama: "Ev yapƒ±mƒ± kek", resim: "images/keks.jpg", emoji: "üç∞" },

            // ü•ê Yƒ∞YECEKLER
           { id: 9, isim: "Kƒ±r pidesi", fiyat: 50, kategori: "yiyecek", aciklama: "Kƒ±ymalƒ±,Peynirli,Patatesli", resim: "images/kirpidesi.jpg", emoji: "üç∞" },
           {id: 10, isim: "Sarƒ±yer B√∂reƒüi", fiyat: 120, kategori: "tatli", aciklama: "Kƒ±ymalƒ±,Peynirli,Patatesli", resim: "images/sariyer.jpg", emoji: "üç∞" },
            { id: 11, isim: "Simit", fiyat: 25, kategori: "yiyecek", aciklama: "Susamlƒ± simit", resim: "images/simit.jpg", emoji: "ü•ê" },
            { id: 12, isim: "Poƒüa√ßa", fiyat: 20, kategori: "yiyecek", aciklama: "Peynirli,kƒ±ymalƒ±,patatesli,zeytinli poƒüa√ßa", resim: "images/pogaca.jpg", emoji: "ü•ê" },
            { id: 13, isim: "A√ßma", fiyat: 20, kategori: "yiyecek", aciklama: "Yumu≈üacƒ±k a√ßma", resim: "images/acma.jpg", emoji: "ü•ê" },
            { id: 14, isim: "√áubuk", fiyat: 75, kategori: "yiyecek", aciklama: "Tuzlu √ßubuk kraker", resim: "images/cubuk.jpg", emoji: "ü•ê" },

            // ü•§ ƒ∞√áECEKLER
            { id: 21, isim: "√áay", fiyat: 30, kategori: "icecek", aciklama: "Demlik √ßay", resim: "images/cay.jpeg", emoji: "ü•§" },
            { id: 22, isim: "Kola", fiyat: 60, kategori: "icecek", aciklama: "Soƒüuk kola", resim: "images/kolaaa.jpg", emoji: "ü•§" },
            { id: 23, isim: "Meyve Suyu", fiyat: 40, kategori: "icecek", aciklama: "≈ûeftali/Portakal/Kayƒ±sƒ±", resim: "images/meyvesuyuu.jpg", emoji: "ü•§" },
            { id: 24, isim: "Ayran", fiyat: 40, kategori: "icecek", aciklama: "Soƒüuk ayran", resim: "images/ayran.jpg", emoji: "ü•§" },
            { id: 25, isim: "Limonata", fiyat: 50, kategori: "icecek", aciklama: "Taze sƒ±kƒ±m limonata", resim: "images/limonata.jpg", emoji: "ü•§" }
        ];
        let sepet = [];
        let sepetAcik = false;

        // URL'den masa numarasƒ±nƒ± al
        const urlParams = new URLSearchParams(window.location.search);
        const masaNo = urlParams.get('masa') || '1';
        document.getElementById('masaNo').textContent = masaNo;

        // GARSON √áAƒûIR FONKSƒ∞YONU
        window.garsonCagir = function() {
            const btn = document.getElementById('garsonBtn');
            
            fetch('/garson-cagir', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ masa: masaNo })
            })
            .then(res => res.json())
            .then(data => {
                if (data.basarili) {
                    toastGoster('üõéÔ∏è Garson √ßaƒürƒ±ldƒ±! Biraz bekleyin.');
                    
                    btn.disabled = true;
                    btn.style.background = '#ccc';
                    btn.innerHTML = '<span style="font-size:1.5rem;">‚úÖ</span> √áaƒürƒ±ldƒ±';
                    
                    setTimeout(() => {
                        btn.disabled = false;
                        btn.style.background = '#4caf50';
                        btn.innerHTML = '<span style="font-size:1.5rem;">üõéÔ∏è</span> Garson √áaƒüƒ±r';
                    }, 30000);
                }
            })
            .catch(() => {
                toastGoster('Hata olu≈ütu!');
            });
        };

        // MEN√úY√ú G√ñSTER
        function menuyuGoster() {
            const menuDiv = document.getElementById('menu');
            
            const tatlƒ±lar = menu.filter(u => u.kategori === 'tatli');
            const yiyecekler = menu.filter(u => u.kategori === 'yiyecek');
            const icecekler = menu.filter(u => u.kategori === 'icecek');

            let html = '';

            if (tatlƒ±lar.length > 0) {
                html += '<div class="kategori-baslik"><h3>üç∞ Tatlƒ±lar</h3></div>';
                tatlƒ±lar.forEach(urun => html += urunKarti(urun));
            }

            if (yiyecekler.length > 0) {
                html += '<div class="kategori-baslik"><h3>ü•ê Yiyecekler</h3></div>';
                yiyecekler.forEach(urun => html += urunKarti(urun));
            }

            if (icecekler.length > 0) {
                html += '<div class="kategori-baslik"><h3>ü•§ ƒ∞√ßecekler</h3></div>';
                icecekler.forEach(urun => html += urunKarti(urun));
            }
            
            menuDiv.innerHTML = html;
        }

        function urunKarti(urun) {
            return `
                <div class="item">
                    <img src="${urun.resim}" alt="${urun.isim}" class="urun-resim" 
                         onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';"
                         style="display: block;">
                    <div class="emoji-kutu" style="display: none;">${urun.emoji}</div>
                    <h3>${urun.isim}</h3>
                    <p>${urun.aciklama || ''}</p>
                    <div class="fiyat">${urun.fiyat} TL</div>
                    <button onclick="sepeteEkle(${urun.id})">Sepete Ekle</button>
                </div>
            `;
        }

        window.sepeteEkle = function(id) {
            const urun = menu.find(u => u.id === id);
            const sepetteki = sepet.find(u => u.id === id);
            
            if (sepetteki) {
                sepetteki.adet = (sepetteki.adet || 1) + 1;
            } else {
                sepet.push({ ...urun, adet: 1 });
            }
            
            sepetGuncelle();
            toastGoster(`${urun.isim} sepete eklendi`);
            
            if (!sepetAcik) sepetToggle();
        };

        window.sepetMiktarDegistir = function(id, islem) {
            const index = sepet.findIndex(u => u.id === id);
            if (index === -1) return;
            
            if (islem === 'artir') {
                sepet[index].adet += 1;
            } else if (islem === 'azalt') {
                sepet[index].adet -= 1;
                if (sepet[index].adet <= 0) sepet.splice(index, 1);
            }
            
            sepetGuncelle();
        };

        function sepetGuncelle() {
            const sepetListe = document.getElementById('sepet');
            const toplamSpan = document.getElementById('sepetToplam');
            
            if (sepet.length === 0) {
                sepetListe.innerHTML = '<li style="text-align: center; color: #666; list-style: none;">Sepetiniz bo≈ü</li>';
                toplamSpan.innerHTML = 'Toplam: 0 TL';
                document.getElementById('siparisBtn').disabled = true;
                return;
            }

            let html = '';
            let toplam = 0;
            
            sepet.forEach(urun => {
                const araToplam = urun.fiyat * urun.adet;
                toplam += araToplam;
                
                html += `
                    <li>
                        <div style="flex:1">
                            <div><strong>${urun.isim}</strong></div>
                            <div style="font-size:0.8rem; color:#666;">${urun.fiyat} TL x ${urun.adet} = ${araToplam} TL</div>
                        </div>
                        <div class="sepet-urun-adet">
                            <button onclick="sepetMiktarDegistir(${urun.id}, 'azalt')">‚àí</button>
                            <span>${urun.adet}</span>
                            <button onclick="sepetMiktarDegistir(${urun.id}, 'artir')">+</button>
                        </div>
                    </li>
                `;
            });
            
            sepetListe.innerHTML = html;
            toplamSpan.innerHTML = `Toplam: ${toplam} TL`;
            document.getElementById('siparisBtn').disabled = false;
        }

        window.siparisGonder = function() {
            if (sepet.length === 0) {
                toastGoster('Sepetiniz bo≈ü!');
                return;
            }

            const siparis = {
                masa: masaNo,
                urunler: sepet.map(u => ({
                    urun: u.isim,
                    fiyat: u.fiyat,
                    adet: u.adet
                })),
                toplam: sepet.reduce((t, u) => t + (u.fiyat * u.adet), 0)
            };

            fetch('/siparis', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(siparis)
            })
            .then(res => res.json())
            .then(data => {
                if (data.basarili) {
                    toastGoster('‚úÖ Sipari≈üiniz alƒ±ndƒ±! Afiyet olsun.');
                    sepet = [];
                    sepetGuncelle();
                    if (sepetAcik) sepetToggle();
                } else {
                    toastGoster('‚ùå Sipari≈ü g√∂nderilemedi!');
                }
            })
            .catch(() => toastGoster('‚ùå Hata olu≈ütu!'));
        };

        window.sepetToggle = function() {
            const sepetAlan = document.getElementById('sepetAlan');
            const sepetToggleBtn = document.getElementById('sepetToggle');
            sepetAcik = !sepetAcik;
            sepetAlan.classList.toggle('acik');
            sepetToggleBtn.innerHTML = sepetAcik ? '‚ñº' : '‚ñ≤';
        };

        function toastGoster(mesaj) {
            const toast = document.getElementById('toast');
            toast.textContent = mesaj;
            toast.classList.add('goster');
            setTimeout(() => toast.classList.remove('goster'), 2000);
        }

        menuyuGoster();
    </script>
</body>
</html>